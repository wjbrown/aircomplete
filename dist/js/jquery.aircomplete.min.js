/*! jquery.aircomplete 2017-12-08 */
!function(a,b,c,d){function e(b,c){this.el=b,this.options=a.extend({},g,c),this._state={expanded:!1,count:0,current:0},this._inputw=0,this._inputh=0,this._$wrap=null,this._$list=null,this._oldHtml=null,this._ajaxRequest=null,this._results=[],this._debounceTimeout=0,this._cache={},this.init()}var f="aircomplete",g={match:function(a,b){return a.toLowerCase().indexOf(b.toLowerCase())>-1},template:function(a,b){for(var c=a,d=b.trim().split(" "),e=0;e<d.length;e++)c=c.replace(new RegExp("("+d[e]+")","igm"),"<strong>$1</strong>");return c},onSelect:function(a){return a.name},inheritStyles:!0,minSearchStringLength:3,data:[],ajaxOptions:{dataType:"json",method:"GET"},dataKey:"",searchDelay:200,cache:!0,debug:!1};e.prototype={init:function(){this._oldHtml=a(this.el).clone(),this._inputw=a(this.el).outerWidth(),this._inputh=a(this.el).outerHeight(),a(this.el).prop("autocomplete","off");var d=a("<div></div>");d.width(this._inputw).height(this._inputh).addClass("aircomplete"),a(this.el).wrap(d),this._$wrap=a(this.el).parent();var e=a("<ul class='aircomplete-list'></ul>");this.options.inheritStyles&&e.css({width:this._inputw,fontFamily:a(this.el).css("font-family"),fontSize:a(this.el).css("font-size")}),this._$wrap.append(e),this._$list=this._$wrap.find("ul:first"),a(this._$list).on("click.aircomplete",this._onClick),a(this.el).on("focus.aircomplete",this._onFocus.bind(this)).on("keydown.aircomplete",this._onKeydown.bind(this)).on("keyup.aircomplete",this._onKeyup.bind(this)),a(c).on("click.aircomplete",this._onDocumentClick.bind(this)),a(b).on("resize.aircomplete",this._onWindowResize.bind(this))},_onDocumentClick:function(b){this._debug("aircomplete._onDocumentClick()"),a(b.target).hasClass("aircomplete")||a(b.target).parents(".aircomplete").size()||this._onBlur(b)},_onWindowResize:function(a){this._debug("aircomplete._onWindowResize()"),this._inputw=this._$wrap.parent().width(),this._$wrap.width(this._inputw).height(this._inputh),this._$list.width(this._inputw)},_onFocus:function(a){this._debug("aircomplete._onFocus()"),this._$list.show()},_onBlur:function(a){this._debug("aircomplete._onBlur()"),this._$list.hide()},_onKeydown:function(a){switch(this._debug("aircomplete._onKeydown()"),a.which){case 9:this._onBlur(a);break;case 13:a.preventDefault();break;case 38:a.preventDefault(),this.focusPrevListItem();break;case 40:a.preventDefault(),this.focusNextListItem()}},_onKeyup:function(b){switch(this._debug("aircomplete._onKeyup()"),b.preventDefault(),b.which){case 38:case 40:break;case 13:this.selectListItem();break;default:var c=a(this.el).val();c.length>=this.options.minSearchStringLength?this._debounce(function(){this._search(c)}.bind(this),this.options.searchDelay):this.emptyList()}},_onClick:function(b){this._debug("aircomplete._onClick()"),a(b.target).closest("li.aircomplete-list-item")&&(this._state.current=a(b.target).closest("li.aircomplete-list-item").index()+1),this.selectListItem()},_debounce:function(a,b){this._debounceTimeout&&clearTimeout(this._debounceTimeout),this._debounceTimeout=setTimeout(a,b)},_search:function(a){this._debug("aircomplete.search()"),this.options.ajaxOptions.url?this._ajaxSearch(a):this._localSearch(a)},_ajaxSearch:function(b){this._debug("aircomplete.ajaxSearch()");var c=this.options.ajaxOptions.url.replace("{{searchTerm}}",encodeURIComponent(b));if(this.options.cache&&this._cache.hasOwnProperty(c))return this.options.data=this._cache[c],this._localSearch(b);var d=a.extend({},this.options.ajaxOptions,{url:c});this._ajaxRequest&&this._ajaxRequest.abort(),this._ajaxRequest=a.ajax(d),this._ajaxRequest.then(function(a){this.options.cache&&(this._cache[c]=a);var d=this._normalizeData(a),e=this._filterResults(d,b);this._populateList(e,b)}.bind(this))},_localSearch:function(b){this._debug("aircomplete.localSearch()");var c=a.isFunction(this.options.data)?this.options.data():this.options.data,d=this._normalizeData(c),e=this._filterResults(d,b);this._populateList(e,b)},_normalizeData:function(a){return""!==this.options.dataKey&&a.hasOwnProperty(this.options.dataKey)?a[this.options.dataKey]:a},_filterResults:function(a,b){var c=[];for(var d in a)this.options.match(a[d],b)&&c.push(a[d]);return c},_populateList:function(a,b){if(this._debug("aircomplete._populateList()"),this._results=a,a.length){this._state.count=a.length;for(var c="",d=0;d<a.length;d++)c+="<li class='aircomplete-list-item'>"+this.options.template(a[d],b)+"</li>";this._$list.html(c),this.showList()}else this.emptyList()},_debug:function(a){this.options.debug&&console.log(a)},focusNextListItem:function(){this._debug("aircomplete.focusNextListItem()"),this._state.expanded&&(this._state.current=(this._state.current+1)%(this._state.count+1),this.focusListItem(this._state.current-1))},focusPrevListItem:function(){this._debug("aircomplete.focusPrevListItem()"),this._state.expanded&&(this._state.current=0===this._state.current?this._state.count:this._state.current-1,this.focusListItem(this._state.current-1))},focusListItem:function(a){this._debug("aircomplete.focusListItem()"),this._state.expanded&&(this._$list.find("li").removeClass("aircomplete-focused"),this._$list.find("li:nth("+a+")").addClass("aircomplete-focused"))},selectListItem:function(){if(this._debug("aircomplete.selectListItem()"),this._state.current){var b=this.options.onSelect(this._results[this._state.current-1]);!1!==b&&(this.setInputValue(b),this.emptyList(),a(this.el).focus())}},setInputValue:function(b){a(this.el).val(b)},showList:function(){this._debug("aircomplete.showList()"),this._state.expanded=!0,this._$list.show()},hideList:function(){this._debug("aircomplete.hideList()"),this._state.expanded=!1,this._$list.hide()},emptyList:function(){this._debug("aircomplete.emptyList()"),this._state={count:0,current:0},this._$list.html(""),this.hideList()},destroy:function(){a(this._$list).off("click.aircomplete"),a(this.el).off("focus.aircomplete").off("keydown.aircomplete").off("keyup.aircomplete"),a(c).off("click.aircomplete"),a(b).off("resize.aircomplete"),this._$wrap.replaceWith(this._oldHtml)}},a.fn[f]=function(b){var c=arguments;if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var g;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(g=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),g!==d?g:this}return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document);